<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.1 at 2020-03-29 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20200329" />
    <meta http-equiv="Content-Language" content="en" />
    <title>WrzasqPl CodePipeline-CodeBuild automation macro &#x2013; </title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
      <script type="text/javascript" src="../js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarDisabled">
      <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>WrzasqPl CodePipeline-CodeBuild automation macro</h2>
</div>
</div>
        <div class="pull-right"><a href="https://wrzasq.pl" id="bannerRight"><h2><img src="https://static.wrzasq.pl/images/wrzasqpl.png" alt="Wrzasq.pl"/></h2>
</a></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
<ul class="nav nav-list">
          <li class="nav-header">Main</li>
    <li><a href="https://github.com/rafalwrzeszcz-wrzasqpl/pl.wrzasq.lambda/" class="externalLink" title="GitHub project"><span class="none"></span>GitHub project</a>  </li>
    <li><a href="https://wrzasq.pl/" class="externalLink" title="Wrzasq.pl"><span class="none"></span>Wrzasq.pl</a>  </li>
    <li><a href="https://www.facebook.com/wrzasqpl" class="externalLink" title="Wrzasq.pl @ Facebook"><span class="none"></span>Wrzasq.pl @ Facebook</a>  </li>
          <li class="nav-header">Parent Project</li>
    <li><a href="../../index.html" title="WrzasqPl Lambda"><span class="none"></span>WrzasqPl Lambda</a>  </li>
          <li class="nav-header">Guide</li>
    <li class="active"><a href="#"><span class="none"></span>Usage</a>
  </li>
          <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a>  </li>
    <li><a href="../project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a>  </li>
  </ul>
          <hr />
          <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
  <a href="https://maven.apache.org/" title="Maven" class="builtBy"><img class="builtBy"  alt="Apache Maven" src="https://maven.apache.org/images/logos/maven-feather.png"    /></a>
<a href="https://wrzasq.pl" title="Wrzasq.pl" class="builtBy"><img class="builtBy"  alt="Wrzasq.pl" src="https://static.wrzasq.pl/images/wrzasqpl.png"    /></a>
              </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<!---
# This file is part of the pl.wrzasq.lambda.
#
# @license http://mit-license.org/ The MIT license
# @copyright 2020 © by Rafał Wrzeszcz - Wrzasq.pl.
-->
<p>TODO</p>
<h1>Using in CloudFormation</h1>
<p>By using this macro handler, it&#x2019;s easy to create a <b>CodeBuild</b> project pre-configured for use in <b>CodePipeline</b>:</p>
<ul>

<li>managed log group with customizable retention period;</li>
<li>source and artifacts are by default set to use CODEPIPELINE;</li>
<li>build environment is by default set to run LINUX_CONTAINER on BUILD_GENERAL1_SMALL,</li>
<li>simplified environment variables setting as key-value map.</li>
</ul>
<h1>Required permissions</h1>
<p>lambda-macro-pipeline-project Needs no specific permissions, you may want to add following policies to it&#x2019;s role:</p>
<ul>

<li>arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole (if you want to see <b>CloudWatch</b> logs of resource handler execution);</li>
<li>arn:aws:iam::aws:policy/AWSXrayWriteOnlyAccess (if you want more detailed tracing, package is built with <b>X-Ray</b> instrumentor).</li>
</ul>
<h1>Definition</h1>
<p>Type: WrzasqPl::Pipeline::Project.</p><section>
<h2><a name="Properties"></a>Properties</h2>
<p>All of the properties are transparently forwarder to <a class="externalLink" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-codebuild-project.html">AWS::CodeBuild::Project</a> resource. Additionally following properties are available to customize extra resources:</p></section><section>
<h2><a name="LogsRetentionInDays_-_number"></a>LogsRetentionInDays - number</h2>
<p>Number of days for log retention (by default 14).</p></section><section>
<h2><a name="Variables_-_string_.3D.3E_string"></a>Variables - string =&gt; string</h2>
<p>Key-value mapping of environment variables. It&#x2019;s a more convenient way than Environment.EnvironmentVariables, which requires list of entries instead of simple mapping. Both variables list will be merged, so you can use both (if you, for whatever, reason want to).</p></section><section>
<h2><a name="Output_values"></a>Output values</h2>
<p>Any reference to Ref or GetAtt on this virtual resource will be replace by analogical call to physical AWS::CodeBuild::Project creation in place of it.</p>
<p><b>Note:</b> When you add this virtual resource to any DependsOn claus it will be replaced by log group dependency, to ensure any execution of created Lambda function will occur after creation of it&#x2019;s managed log group.</p>
<h1>Example</h1>

<div>
<div>
<pre class="source">Transform:
    - &quot;WrzasqPlPipelineProject&quot;

Resources:
    EnhancedLambda:
        Type: &quot;WrzasqPl::Pipeline::Project&quot;
        Properties:
            ServiceRole: !Ref &quot;BuildRole&quot;
            Environment:
                Image: &quot;aws/codebuild/amazonlinux2-x86_64-standard:2.0&quot;
            Variables:
                COMPONENT_ID: !Ref &quot;ComponentId&quot;
                REPOSITORY_BUCKET: !ImportValue &quot;RepositoryBucket:Name&quot;
            # you can still define Artifacts and Source if you want to override
</pre></div></div>

<h1>Installation</h1>

<div>
<div>
<pre class="source">    MacroFunctionRole:
        Type: &quot;AWS::IAM::Role&quot;
        Properties:
            AssumeRolePolicyDocument:
                Statement:
                    -
                        Action: &quot;sts:AssumeRole&quot;
                        Effect: &quot;Allow&quot;
                        Principal:
                            Service:
                                - &quot;lambda.amazonaws.com&quot;
            ManagedPolicyArns:
                - &quot;arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole&quot;

    MacroFunction:
        Type: &quot;AWS::Serverless::Function&quot;
        Properties:
            Runtime: &quot;java11&quot;
            Code:
                # put your source bucket
                S3Bucket: &quot;your-bucket&quot;
                S3Key: &quot;lambda-macro-pipeline-project-1.1.1-standalone.jar&quot;
            Handler: &quot;pl.wrzasq.lambda.macro.pipeline.project.Handler::handleRequest&quot;
            MemorySize: 256
            Description: &quot;Custom CloudFormation macro handler.&quot;
            Timeout: 300
            TracingConfig:
                Mode: &quot;Active&quot;
            Role: !GetAtt &quot;MacroFunctionRole.Arn&quot;

    Macro:
        Type: &quot;AWS::CloudFormation::Macro&quot;
        Properties:
            Name: &quot;WrzasqPlPipelineProject&quot;
            FunctionName: !GetAtt &quot;MacroFunction.Arn&quot;
</pre></div></div></section>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2020
<a href="https://wrzasq.pl/">Rafał Wrzeszcz - Wrzasq.pl</a>.
All rights reserved.        <li id="publishDate" class="pull-right">Last Published: 2020-03-29</li>
          <li id="projectVersion" class="pull-right">Version: 1.1.2</li>
</p>
        </div>
        </div>
    </footer>
    </body>
</html>
